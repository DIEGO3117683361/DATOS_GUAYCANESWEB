<script>
    let searchTimeout;

    function buscarNUP() {
        console.log('Función buscarNUP llamada');
        const nup = document.getElementById('nup-input').value;
        const scriptURL = 'https://script.google.com/macros/s/AKfycbyjdP1JW7PRhIpf-S3P9cINx2k0Rk1Gi-VpviwEWvQCKUXCzsafjnLh2PK0brUWO8C6/exec'; // Reemplaza con la URL generada en el paso anterior
        const searchingBanner = document.getElementById('searching-banner');
        const resultContainer = document.getElementById('result');

        if (!nup) {
            resultContainer.innerHTML = '<p>Por favor, ingrese un código NUP.</p>';
            return;
        }

        searchingBanner.style.display = 'block';

        fetch(`${scriptURL}?nup=${nup}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error en la respuesta de la red');
                }
                return response.json();
            })
            .then(data => {
                console.log('Datos recibidos:', data);
                if (data.success) {
                    resultContainer.innerHTML = `
                        <p><strong>Datos encontrados:</strong></p>
                        <p>Código NUP: ${data.nup}</p>
                        <p>Nombre: ${data.nombre}</p>
                        <p>Documento: ${data.documento}</p>
                        <p>Correo Electrónico: ${data.correo}</p>
                        <p>Teléfono: ${data.telefono}</p>
                        <p>Número de Parcela: ${data.parcela}</p>
                        <p>Cuota Uno: ${data.cuota1}</p>
                        <p>Cuota Dos: ${data.cuota2}</p>
                        <p>Cuota Tres: ${data.cuota3}</p>
                        <p>Documentos Disponibles: ${data.documentos}</p>
                        <p>Próxima Fecha de Pago: ${data.proximaFechaPago}</p>
                    `;
                } else {
                    resultContainer.innerHTML = `<p>No se encontraron datos para el NUP ingresado.</p>`;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                resultContainer.innerHTML = `<p>Error al buscar los datos. Intente nuevamente.</p>`;
            })
            .finally(() => {
                searchingBanner.style.display = 'none';
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    resultContainer.innerHTML = '';
                }, 5 * 60 * 1000);
            });
    }
</script>
